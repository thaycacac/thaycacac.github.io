<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover">
  <title>
    Deploy
  </title>
  <meta name="author" content="Thaycacac" />
  
  
  <meta name="keywords" content="thaycacac, phạm ngọc hòa, pham ngoc hoa" />
   
  <meta name="p:domain_verify" content="a2be4006f87e62fc1cb690ce12700c90"/>
  <link rel="alternate" type="application/rss+xml" title="Thaycacac | Phạm Ngọc Hòa"
    href="/feed.xml" />
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-137167305-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());

  gtag('config', 'UA-137167305-1');
</script>

  
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            'gtm.start': new Date().getTime(),
            event: 'gtm.js'
        });
        var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s),
            dl = l != 'dataLayer' ? '&l=' + l : '';
        j.async = true;
        j.src =
            'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-K9C9P7Z');
</script>

  
  
  
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css" />

  
  
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" />
  
  <link rel="stylesheet" href="/css/bootstrap-social.css" />
  
  <link rel="stylesheet" href="/css/main.css" />
  
  <link rel="stylesheet" href="/css/jquery-sakura.min.css" />
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  
  
  
  

  

  
  <meta property="fb:app_id" content="2190189127692080" />
  

  
  <meta property="og:title" content="Deploy" />
  

  
  <meta property="og:description" content="## Deploy backend Update ```ssh sudo apt-get update -y sudo apt-get upgrade -y ``` Install git, nodejs, curl, yarn ```ssh sudo apt-get install git nodejs npm curl npm install -g yarn curl -sL https://deb.nodesource.com/setup_10.x -o nodesource_setup.sh sudo bash nodesource_setup.sh sudo apt install nodejs ``` Check version ```ssh git --version nodejs...">
  

  <meta property="og:type" content="website" />

  
  <meta property="og:url" content="http://thaycacac.github.io/deploy/" />
  <link rel="canonical" href="http://thaycacac.github.io/deploy/" />
  

  
  <meta property="og:image" content="http://thaycacac.github.io/img/avatar-icon.png" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <meta name="twitter:creator" content="@" />

  
  <meta name="twitter:title" content="Deploy" />
  

  
  <meta name="twitter:description" content="## Deploy backend Update ```ssh sudo apt-get update -y sudo apt-get upgrade -y ``` Install git, nodejs, curl, yarn ```ssh sudo apt-get install git nodejs npm curl npm install -g yarn curl -sL https://deb.nodesource.com/setup_10.x -o nodesource_setup.sh sudo bash nodesource_setup.sh sudo apt install nodejs ``` Check version ```ssh git --version nodejs...">
  

  
  <meta name="twitter:image" content="http://thaycacac.github.io/img/avatar-icon.png" />
  

  
  
</head>


<body>

  
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K9C9P7Z" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


  <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="http://thaycacac.github.io">Thaycacac</a>
      
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
        
        <li>
          






<a href="/frontend">Front End</a>
        </li>
        
        
        
        <li>
          






<a href="/backend">Back End</a>
        </li>
        
        
        
        <li>
          






<a href="/uiux">UI/UX</a>
        </li>
        
        
        
        <li>
          






<a href="/donate">Donate</a>
        </li>
        
        
        
        <li>
          






<a href="https://kungfutech.edu.vn/">Kungfutech</a>
        </li>
        
        
      </ul>
    </div>

    

  </div>
</nav>

  



<header class="header-section ">
  
  <div class="intro-header no-img">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
          <div class="page-heading">
            <h1>Deploy</h1>
            
            
            <hr class="small">
            <span class="page-subheading">Lavaral - Nuxt</span>
            
            

            
          </div>
        </div>
      </div>
    </div>
  </div>
</header>




<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <h2 id="deploy-backend">Deploy backend</h2>

<p>Update</p>

<div class="language-ssh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">sudo</span> apt-get update -y
<span class="k">sudo</span> apt-get upgrade -y
</code></pre></div></div>

<p>Install git, nodejs, curl, yarn</p>

<div class="language-ssh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">sudo</span> apt-get install git nodejs npm curl
<span class="k">npm</span> install -g yarn
<span class="k">curl</span> -sL https://deb.nodesource.com/setup_10.x -o nodesource_setup.sh
<span class="k">sudo</span> bash nodesource_setup.sh
<span class="k">sudo</span> apt install nodejs
</code></pre></div></div>

<p>Check version</p>

<div class="language-ssh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">git</span> --version
<span class="k">nodejs</span> --version
<span class="k">yarn</span> --version
</code></pre></div></div>

<p>Install php,…</p>

<div class="language-ssh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">sudo</span> apt-get install php7.2 php7.2-fpm php7.2-mysql php7.2-curl php7.2-gd php7.2-mbstring php7.2-xml php7.2-xmlrpc php-zip
</code></pre></div></div>

<p>Install composer</p>

<div class="language-ssh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">sudo</span> apt install composer
</code></pre></div></div>

<p>Install database</p>

<div class="language-ssh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">//</span> <span class="err">---------</span><span class="k">MYSQL</span>----------
<span class="k">sudo</span> apt install mysql-client-core-5.7
<span class="k">sudo</span> apt install mysql-server
<span class="k">sudo</span> systemctl status mysql
</code></pre></div></div>

<p>Install project</p>

<div class="language-ssh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">sudo</span> mkdir /var/www
<span class="k">git</span> clone https://github.com/thaycacac.git
<span class="k">cd</span> thaycacac
<span class="k">composer</span> install
<span class="k">yarn</span>
</code></pre></div></div>

<p>Create database</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span> <span class="o">-</span><span class="n">p</span>
<span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">thaycacac</span> <span class="k">DEFAULT</span> <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">utf8mb4</span> <span class="k">COLLATE</span> <span class="n">utf8mb4_unicode_ci</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="n">thaycacac</span><span class="p">.</span><span class="o">*</span> <span class="k">TO</span> <span class="s1">'thaycacacuser'</span><span class="o">@</span><span class="s1">'localhost'</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">'123456'</span><span class="p">;</span>
<span class="n">use</span> <span class="n">thaycacac</span><span class="p">;</span>
<span class="k">source</span> <span class="k">data</span><span class="p">.</span><span class="k">sql</span><span class="p">;</span>
</code></pre></div></div>

<p>Config file <code class="language-plaintext highlighter-rouge">.env</code></p>

<div class="language-ssh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">touch</span> .env
<span class="k">nano</span> .env
</code></pre></div></div>

<div class="language-ssh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DB</span>_HOST=127.0.0.1
<span class="k">DB</span>_NAME=thaycacac
<span class="k">DB</span>_USER=thaycacacuser
<span class="k">DB</span>_PASSWORD=123456
</code></pre></div></div>

<p>Install web server (Caddy)</p>

<div class="language-ssh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">sudo</span> apt install -y debian-keyring debian-archive-keyring apt-transport-https
<span class="k">curl</span> -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/gpg.key' | sudo gpg --dearmor -o /usr/share/keyrings/caddy-stable-archive-keyring.gpg
<span class="k">curl</span> -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/debian.deb.txt' | sudo tee /etc/apt/sources.list.d/caddy-stable.list
<span class="k">sudo</span> apt update
<span class="k">sudo</span> apt install caddy=2.3.0

<span class="k">sudo</span> chmod <span class="m">777</span> /var/www/html/.../public/uploads/...
</code></pre></div></div>

<ul>
  <li>Config web server</li>
</ul>

<div class="language-ssh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">kungfutech</span>.edu.vn, kungfutech.edu.vn:80 <span class="err">{</span>
  <span class="k">tls</span> thaycacac@gmail.com
  <span class="k">encode</span> gzip
  <span class="k">reverse</span>_proxy localhost:7985
<span class="err">}</span>

<span class="k">api</span>.kungfutech.edu.vn <span class="err">{</span>
  <span class="k">header</span> Cache-Control max-age=31536000
  <span class="k">header</span> Strict-Transport-Security max-age=31536000
  <span class="k">header</span> Referrer-Policy <span class="no">no</span>-referrer-when-downgrade
  <span class="k">header</span> X-Frame-Options DENY
  <span class="k">header</span> X-Content-Type-Options nosniff
  <span class="k">root</span> * /var/www/stech.edu.vn.back/public
  <span class="k">php</span>_fastcgi unix//run/php/php7.2-fpm.sock
  <span class="k">encode</span> gzip
  <span class="k">file</span>_server
<span class="err">}</span>

<span class="k">www</span>.kungfutech.edu.vn <span class="err">{</span>
   <span class="k">redir</span> https://kungfutech.edu.vn <span class="err">{</span>uri<span class="err">}</span>
<span class="err">}</span>

<span class="k">http</span>://kungfutech.edu.vn <span class="err">{</span>
  <span class="k">redir</span> https://<span class="err">{</span>host<span class="err">}{</span>uri<span class="err">}</span>
<span class="err">}</span>
</code></pre></div></div>

<p>Restart web server</p>

<div class="language-ssh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">sudo</span> systemctl restart caddy
</code></pre></div></div>

<h2 id="deploy-nuxt">Deploy nuxt</h2>

<p>Install yarn,git,…and build project</p>

<div class="language-ssh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">yarn</span> build
<span class="k">yarn</span> start
<span class="err">```</span>

<span class="k">Install</span> pm2

<span class="err">```</span><span class="k">ssh</span>
<span class="k">npm</span> install pm2 -g
<span class="k">pm2</span> start yarn -- start
</code></pre></div></div>

<p>Export sql</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span>
<span class="n">FLUSH</span> <span class="k">PRIVILEGES</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">USER</span> <span class="s1">'root'</span><span class="o">@</span><span class="s1">'localhost'</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">'123456'</span><span class="p">;</span>
<span class="n">mysqldump</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span> <span class="o">-</span><span class="n">p</span> <span class="n">thaycacac</span> <span class="o">&gt;</span> <span class="k">data</span><span class="p">.</span><span class="k">sql</span>
</code></pre></div></div>

<h2 id="cicd">CI/CD</h2>

<p>Gen SSH Key</p>

<div class="language-ssh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">mkdir</span> -p <span class="err">$</span>HOME/.ssh
<span class="k">chmod</span> <span class="m">0700</span> <span class="err">$</span>HOME/.ssh
<span class="k">ssh</span>-keygen
<span class="k">vim</span> /root/.ssh/id_rsa.pub
</code></pre></div></div>

<p><a href="https://github.com/settings/keys">Add SSH Key</a></p>

<p>Set repo:</p>

<div class="language-ssh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">git</span> remote set-url origin git@github.com:
</code></pre></div></div>

<p>CD Frontend</p>

<div class="language-ssh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">name</span>: CD
<span class="k">on</span>:
  <span class="k">push</span>:
    <span class="k">branches</span>:
      <span class="err">-</span> <span class="k">production</span>
      <span class="err">-</span> <span class="k">master</span>
      <span class="err">-</span> <span class="k">main</span>
  <span class="k">schedule</span>:
    <span class="err">-</span> <span class="k">cron</span>: '* <span class="m">6</span> * * *'

<span class="k">jobs</span>:
  <span class="k">ci</span>-test:
    <span class="k">runs</span>-on: ubuntu-18.04
    <span class="k">strategy</span>:
      <span class="k">matrix</span>:
        <span class="k">node</span>-version: [14.x]
    <span class="k">steps</span>:
    <span class="err">-</span> <span class="k">uses</span>: actions/checkout@v2

    <span class="err">-</span> <span class="k">name</span>: Deploy
      <span class="k">uses</span>: appleboy/ssh-action@master
      <span class="k">with</span>:
        <span class="k">host</span>: <span class="err">$</span>
        <span class="k">password</span>: <span class="err">$</span>
        <span class="k">username</span>: root
        <span class="k">script</span>: cd /var/www/stech.edu.vn
          <span class="err">&amp;&amp;</span> <span class="k">git</span> pull
          <span class="err">&amp;&amp;</span> <span class="k">yarn</span>
          <span class="err">&amp;&amp;</span> <span class="k">yarn</span> build
          <span class="err">&amp;&amp;</span> <span class="k">pm2</span> restart yarn
</code></pre></div></div>


      
    </div>
  </div>
</div>

  <footer class="is-footer">
  <div class="container beautiful-jekyll-footer">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links"><li><a href="/feed.xml" title="RSS"><span class="fa-stack fa-lg" aria-hidden="true">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                  </span>
                  <span class="sr-only">RSS</span>
                </a>
          </li><li><a href="mailto:thaycacac@gmail.com" title="Email me"><span class="fa-stack fa-lg" aria-hidden="true">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                  <span class="sr-only">Email me</span>
                </a>
          </li><li><a href="https://www.facebook.com/thaycacac" title="Facebook"><span class="fa-stack fa-lg" aria-hidden="true">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                  </span>
                  <span class="sr-only">Facebook</span>
                </a>
          </li><li><a href="https://twitter.com/thaycacac" title="Twitter"><span class="fa-stack fa-lg" aria-hidden="true">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                  <span class="sr-only">Twitter</span>
                </a>
          </li><li><a href="tel:84968038714" title="Phone"><span class="fa-stack fa-lg" aria-hidden="true">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-phone fa-stack-1x fa-inverse"></i>
                  </span>
                  <span class="sr-only">Phone</span>
                </a>
          </li><li><a href="https://linkedin.com/in/thaycacac" title="LinkedIn"><span class="fa-stack fa-lg" aria-hidden="true">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                  <span class="sr-only">LinkedIn</span>
                </a>
          </li><li><a href="https://www.instagram.com/thaycacac" title="Instagram"><span class="fa-stack fa-lg" aria-hidden="true">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-instagram fa-stack-1x fa-inverse"></i>
                  </span>
                  <span class="sr-only">Instagram</span>
                </a>
          </li><li><a href="https://www.youtube.com/channel/UCSfVU0_rcB5Kn1SkYrcTbRw" title="YouTube"><span class="fa-stack fa-lg" aria-hidden="true">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-youtube fa-stack-1x fa-inverse"></i>
                  </span>
                  <span class="sr-only">YouTube</span>
                </a>
          </li></ul>
        <p class="copyright text-muted">
          Thaycacac
          &nbsp;&bull;&nbsp;
          2024

          
          &nbsp;&bull;&nbsp;
          <a href="http://thaycacac.github.io">thaycacac.github.io</a>
          

          
        </p>
      </div>
    </div>
  </div>
</footer>

  







<!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->

<script src="/js/jquery-1.11.2.min.js"></script>
<script src="/js/jquery-sakura.min.js"></script>

<script>
  if (typeof jQuery == 'undefined') {
    document.write('<script src="/js/jquery-1.11.2.min.js"></scr' + 'ipt>');
  }
</script>


<!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->

<script src="/js/bootstrap.min.js"></script>


<!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->

<script src="/js/main.js"></script>





<script>
	(function (i, s, o, g, r, a, m) {
		i['GoogleAnalyticsObject'] = r;
		i[r] = i[r] || function () {
			(i[r].q = i[r].q || []).push(arguments)
		}, i[r].l = 1 * new Date();
		a = s.createElement(o),
			m = s.getElementsByTagName(o)[0];
		a.async = 1;
		a.src = g;
		m.parentNode.insertBefore(a, m)
	})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
	ga('create', 'UA-137167305-1', 'auto');
	ga('send', 'pageview');
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-137167305-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-137167305-1');
</script>
<!-- End Google Analytics -->


</body>
<script>
$(window).load(function () {
  $('body').sakura();
});
</script>

</html>